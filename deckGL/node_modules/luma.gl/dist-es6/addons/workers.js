var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

// workers.js
//
/* global Worker */
/* eslint-disable one-var, indent */

var WorkerGroup = function () {
  function WorkerGroup(fileName, n) {
    _classCallCheck(this, WorkerGroup);

    var workers = this.workers = [];
    while (n--) {
      workers.push(new Worker(fileName));
    }
  }

  _createClass(WorkerGroup, [{
    key: "map",
    value: function map(func) {
      var workers = this.workers;
      var configs = this.configs = [];

      for (var i = 0, l = workers.length; i < l; i++) {
        configs.push(func && func(i));
      }

      return this;
    }
  }, {
    key: "reduce",
    value: function reduce(opt) {
      var fn = opt.reduceFn;
      var workers = this.workers;
      var configs = this.configs;
      var l = workers.length;
      var acum = opt.initialValue;
      var message = function message(e) {
        l--;
        if (acum === undefined) {
          acum = e.data;
        } else {
          acum = fn(acum, e.data);
        }
        if (l === 0) {
          opt.onComplete(acum);
        }
      };
      for (var i = 0, ln = l; i < ln; i++) {
        var w = workers[i];
        w.onmessage = message;
        w.postMessage(configs[i]);
      }

      return this;
    }
  }]);

  return WorkerGroup;
}();

export { WorkerGroup as default };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hZGRvbnMvd29ya2Vycy5qcyJdLCJuYW1lcyI6WyJXb3JrZXJHcm91cCIsImZpbGVOYW1lIiwibiIsIndvcmtlcnMiLCJwdXNoIiwiV29ya2VyIiwiZnVuYyIsImNvbmZpZ3MiLCJpIiwibCIsImxlbmd0aCIsIm9wdCIsImZuIiwicmVkdWNlRm4iLCJhY3VtIiwiaW5pdGlhbFZhbHVlIiwibWVzc2FnZSIsInVuZGVmaW5lZCIsImUiLCJkYXRhIiwib25Db21wbGV0ZSIsImxuIiwidyIsIm9ubWVzc2FnZSIsInBvc3RNZXNzYWdlIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7O0lBRXFCQSxXO0FBRW5CLHVCQUFZQyxRQUFaLEVBQXNCQyxDQUF0QixFQUF5QjtBQUFBOztBQUN2QixRQUFNQyxVQUFVLEtBQUtBLE9BQUwsR0FBZSxFQUEvQjtBQUNBLFdBQU9ELEdBQVAsRUFBWTtBQUNWQyxjQUFRQyxJQUFSLENBQWEsSUFBSUMsTUFBSixDQUFXSixRQUFYLENBQWI7QUFDRDtBQUNGOzs7O3dCQUVHSyxJLEVBQU07QUFDUixVQUFNSCxVQUFVLEtBQUtBLE9BQXJCO0FBQ0EsVUFBTUksVUFBVSxLQUFLQSxPQUFMLEdBQWUsRUFBL0I7O0FBRUEsV0FBSyxJQUFJQyxJQUFJLENBQVIsRUFBV0MsSUFBSU4sUUFBUU8sTUFBNUIsRUFBb0NGLElBQUlDLENBQXhDLEVBQTJDRCxHQUEzQyxFQUFnRDtBQUM5Q0QsZ0JBQVFILElBQVIsQ0FBYUUsUUFBUUEsS0FBS0UsQ0FBTCxDQUFyQjtBQUNEOztBQUVELGFBQU8sSUFBUDtBQUNEOzs7MkJBRU1HLEcsRUFBSztBQUNWLFVBQU1DLEtBQUtELElBQUlFLFFBQWY7QUFDQSxVQUFNVixVQUFVLEtBQUtBLE9BQXJCO0FBQ0EsVUFBTUksVUFBVSxLQUFLQSxPQUFyQjtBQUNBLFVBQUlFLElBQUlOLFFBQVFPLE1BQWhCO0FBQ0EsVUFBSUksT0FBT0gsSUFBSUksWUFBZjtBQUNBLFVBQU1DLFVBQVUsU0FBVkEsT0FBVSxJQUFLO0FBQ25CUDtBQUNBLFlBQUlLLFNBQVNHLFNBQWIsRUFBd0I7QUFDdEJILGlCQUFPSSxFQUFFQyxJQUFUO0FBQ0QsU0FGRCxNQUVPO0FBQ0xMLGlCQUFPRixHQUFHRSxJQUFILEVBQVNJLEVBQUVDLElBQVgsQ0FBUDtBQUNEO0FBQ0QsWUFBSVYsTUFBTSxDQUFWLEVBQWE7QUFDWEUsY0FBSVMsVUFBSixDQUFlTixJQUFmO0FBQ0Q7QUFDRixPQVZEO0FBV0EsV0FBSyxJQUFJTixJQUFJLENBQVIsRUFBV2EsS0FBS1osQ0FBckIsRUFBd0JELElBQUlhLEVBQTVCLEVBQWdDYixHQUFoQyxFQUFxQztBQUNuQyxZQUFNYyxJQUFJbkIsUUFBUUssQ0FBUixDQUFWO0FBQ0FjLFVBQUVDLFNBQUYsR0FBY1AsT0FBZDtBQUNBTSxVQUFFRSxXQUFGLENBQWNqQixRQUFRQyxDQUFSLENBQWQ7QUFDRDs7QUFFRCxhQUFPLElBQVA7QUFDRDs7Ozs7O1NBNUNrQlIsVyIsImZpbGUiOiJ3b3JrZXJzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gd29ya2Vycy5qc1xuLy9cbi8qIGdsb2JhbCBXb3JrZXIgKi9cbi8qIGVzbGludC1kaXNhYmxlIG9uZS12YXIsIGluZGVudCAqL1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXb3JrZXJHcm91cCB7XG5cbiAgY29uc3RydWN0b3IoZmlsZU5hbWUsIG4pIHtcbiAgICBjb25zdCB3b3JrZXJzID0gdGhpcy53b3JrZXJzID0gW107XG4gICAgd2hpbGUgKG4tLSkge1xuICAgICAgd29ya2Vycy5wdXNoKG5ldyBXb3JrZXIoZmlsZU5hbWUpKTtcbiAgICB9XG4gIH1cblxuICBtYXAoZnVuYykge1xuICAgIGNvbnN0IHdvcmtlcnMgPSB0aGlzLndvcmtlcnM7XG4gICAgY29uc3QgY29uZmlncyA9IHRoaXMuY29uZmlncyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSB3b3JrZXJzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgY29uZmlncy5wdXNoKGZ1bmMgJiYgZnVuYyhpKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICByZWR1Y2Uob3B0KSB7XG4gICAgY29uc3QgZm4gPSBvcHQucmVkdWNlRm47XG4gICAgY29uc3Qgd29ya2VycyA9IHRoaXMud29ya2VycztcbiAgICBjb25zdCBjb25maWdzID0gdGhpcy5jb25maWdzO1xuICAgIGxldCBsID0gd29ya2Vycy5sZW5ndGg7XG4gICAgbGV0IGFjdW0gPSBvcHQuaW5pdGlhbFZhbHVlO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBlID0+IHtcbiAgICAgIGwtLTtcbiAgICAgIGlmIChhY3VtID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYWN1bSA9IGUuZGF0YTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFjdW0gPSBmbihhY3VtLCBlLmRhdGEpO1xuICAgICAgfVxuICAgICAgaWYgKGwgPT09IDApIHtcbiAgICAgICAgb3B0Lm9uQ29tcGxldGUoYWN1bSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBmb3IgKGxldCBpID0gMCwgbG4gPSBsOyBpIDwgbG47IGkrKykge1xuICAgICAgY29uc3QgdyA9IHdvcmtlcnNbaV07XG4gICAgICB3Lm9ubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgICB3LnBvc3RNZXNzYWdlKGNvbmZpZ3NbaV0pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbn1cbiJdfQ==